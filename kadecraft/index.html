<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>KadeCraft Status</title>
<style>
  :root {
    color-scheme: light dark;
    --bg: #f5f7fa;
    --fg: #111;
    --card: #fff;
    --subtle: #666;
    --accent: #2563eb;
    --border: #e0e4ee;
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #0f172a;
      --fg: #f1f5f9;
      --card: #1e293b;
      --subtle: #9ca3af;
      --accent: #3b82f6;
      --border: #334155;
    }
  }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: var(--bg);
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
  }
  .card {
    background: var(--card);
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    width: min(760px, 100%);
    transition: transform 0.25s;
  }
  .card.updating { transform: scale(1.01); }
  header {
    display: flex;
    gap: 12px;
    align-items: center;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }
  header img {
    width: 56px;
    height: 56px;
    border-radius: 8px;
    background: #ddd;
    object-fit: cover;
  }
  h1 { margin: 0; font-size: 1.2rem; }
  .meta { font-size: .92rem; margin-top: 4px; }
  .status { font-weight: 700; margin-top: 6px; }
  .online { color: #22c55e; }
  .offline { color: #ef4444; }
  .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 8px; }
  .label { color: var(--subtle); font-size: .9rem; }
  .value { font-weight: 700; }
  .players { margin-top: 16px; }
  .player-list { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
  .player { background: var(--bg); border: 1px solid var(--border); padding: 6px 10px; border-radius: 999px; }
  .empty { color: var(--subtle); font-style: italic; }
  footer { margin-top: 16px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; color: var(--subtle); }
  button { background: var(--accent); color: white; border: 0; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: 700; }
  @media (max-width:560px){.grid{grid-template-columns:1fr}}
  /* Minecraft color styles */
  .mc-black{color:#000}.mc-dark_blue{color:#0000aa}.mc-dark_green{color:#00aa00}.mc-dark_aqua{color:#00aaaa}
  .mc-dark_red{color:#aa0000}.mc-dark_purple{color:#aa00aa}.mc-gold{color:#ffaa00}.mc-gray{color:#aaaaaa}
  .mc-dark_gray{color:#555555}.mc-blue{color:#5555ff}.mc-green{color:#55ff55}.mc-aqua{color:#55ffff}
  .mc-red{color:#ff5555}.mc-light_purple{color:#ff55ff}.mc-yellow{color:#ffff55}.mc-white{color:#ffffff}
  .mc-bold{font-weight:700}.mc-italic{font-style:italic}.mc-underlined{text-decoration:underline}
  .mc-strikethrough{text-decoration:line-through}.mc-obfuscated{animation:obf 1s infinite alternate}
  @keyframes obf{0%{opacity:1}100%{opacity:.2}}
</style>
</head>
<body>
  <div class="card" id="card">
    <header>
      <img id="favicon" alt="Server icon" />
      <div>
        <h1 id="serverName">KadeCraft</h1>
        <div class="meta" id="motd">Loading MOTD…</div>
        <div class="status" id="status">Checking…</div>
      </div>
    </header>

    <div class="grid" id="details">
      <div><div class="label">Version</div><div class="value" id="version">—</div></div>
      <div><div class="label">Ping</div><div class="value" id="ping">— ms</div></div>
      <div><div class="label">Players</div><div class="value" id="count">—</div></div>
    </div>

    <div class="players" id="playersContainer">
      <div class="empty">Loading player list…</div>
    </div>

    <footer>
      <div id="lastUpdated">Last updated: —</div>
      <div><button id="refresh">Refresh</button></div>
    </footer>
  </div>

<script>
const IP="nl22.icehost.pl",PORT=25732;
const card=document.getElementById("card"),faviconEl=document.getElementById("favicon"),
motdEl=document.getElementById("motd"),statusEl=document.getElementById("status"),
versionEl=document.getElementById("version"),pingEl=document.getElementById("ping"),
countEl=document.getElementById("count"),playersContainer=document.getElementById("playersContainer"),
lastUpdated=document.getElementById("lastUpdated"),refreshBtn=document.getElementById("refresh");

function colorizeMotd(text){
  if(!text)return "";
  const map={
    0:"mc-black",1:"mc-dark_blue",2:"mc-dark_green",3:"mc-dark_aqua",4:"mc-dark_red",5:"mc-dark_purple",
    6:"mc-gold",7:"mc-gray",8:"mc-dark_gray",9:"mc-blue",a:"mc-green",b:"mc-aqua",c:"mc-red",
    d:"mc-light_purple",e:"mc-yellow",f:"mc-white",
    l:"mc-bold",m:"mc-strikethrough",n:"mc-underlined",o:"mc-italic",k:"mc-obfuscated"
  };
  let html="",open=[],parts=text.split(/(§[0-9A-FK-ORa-fk-or])/g);
  for(let part of parts){
    if(!part)continue;
    const m=part.match(/^§([0-9A-FK-ORa-fk-or])$/i);
    if(m){
      const code=m[1].toLowerCase();
      if(code==="r"){ // reset
        html+="</span>".repeat(open.length); open=[];
      } else {
        const cls=map[code];
        if(cls){ html+=`<span class="${cls}">`; open.push("</span>"); }
      }
    } else html+=part.replace(/</g,"&lt;").replace(/>/g,"&gt;");
  }
  html+=open.reverse().join("");
  return html;
}

function stripMcCodes(s){return s.replace(/§[0-9A-FK-ORa-fk-or]/g,'');}
async function fetchWithPing(url){
  const t0=performance.now();const resp=await fetch(url,{cache:'no-store'});
  const data=await resp.json();const ping=Math.round(performance.now()-t0);
  return {data,ping};
}

async function update(){
  card.classList.add("updating");
  try{
    const {data,ping}=await fetchWithPing(`https://mcapi.us/server/status?ip=${IP}&port=${PORT}`);
    faviconEl.src=data.favicon||`https://api.mcstatus.io/v2/icon/${IP}:${PORT}`;
    let motdRaw=data.motd?.raw||data.motd?.clean||data.motd||data.description||"";
    if(Array.isArray(motdRaw))motdRaw=motdRaw.join(" ");
    const motdHtml=colorizeMotd(typeof motdRaw==="string"?motdRaw:JSON.stringify(motdRaw));
    motdEl.innerHTML=motdHtml||"";
    if(data.online){
      statusEl.textContent="Online";statusEl.className="status online";
    } else {
      statusEl.textContent="Offline";statusEl.className="status offline";
    }
    versionEl.textContent=data.server?.name||data.version||"Unknown";
    pingEl.textContent=ping;
    countEl.textContent=`${data.players.now}/${data.players.max}`;
    playersContainer.innerHTML="";
    if(data.players.sample?.length){
      const list=document.createElement("div");list.className="player-list";
      data.players.sample.forEach(p=>{
        const div=document.createElement("div");div.className="player";div.textContent=p.name;
        list.appendChild(div);
      });
      playersContainer.appendChild(list);
    } else playersContainer.innerHTML='<div class="empty">No players online.</div>';
    lastUpdated.textContent="Last updated: "+new Date().toLocaleTimeString();
  }catch(e){
    motdEl.textContent="Error fetching MOTD";
    statusEl.textContent="Error";statusEl.className="status offline";
    pingEl.textContent="—";playersContainer.innerHTML=`<div class="empty">Error: ${e.message}</div>`;
  }finally{setTimeout(()=>card.classList.remove("updating"),250);}
}

refreshBtn.onclick=update;
update();
setInterval(update,30000);
</script>
</body>
</html>
